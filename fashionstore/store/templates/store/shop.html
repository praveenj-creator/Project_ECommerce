{% extends 'store/base.html' %}
{% load custom_tags %}
{% block title %}Shop â€” LuxeDress{% endblock %}
{% block body %}
{% include 'store/navbar.html' %}
<div class="container py-4">
  <div class="mb-3">
    <nav aria-label="breadcrumb"><ol class="breadcrumb mb-0" style="font-size:.82rem"><li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-decoration-none text-muted">Home</a></li><li class="breadcrumb-item"><a href="#" class="text-decoration-none text-muted">Clothing</a></li><li class="breadcrumb-item active">Shop</li></ol></nav>
  </div>
  <h2 style="font-weight:700;font-size:1.8rem">Dress Collection</h2>
  <p class="text-muted mb-4" style="font-size:.88rem">Discover our curated collection of elegant dresses at exclusive prices.</p>
  <div class="row g-4">

    <!-- SIDEBAR FILTERS -->
    <div class="col-lg-3">
      <form method="get" id="filterForm">
        <div class="card border-0 shadow-sm" style="border-radius:12px">
          <div class="card-body p-3">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <span class="fw-bold" style="font-size:.9rem"><i class="bi bi-funnel me-1"></i>CATEGORY</span>
            </div>
            <div class="mb-3">
              <div class="form-check mb-1">
                <input class="form-check-input" type="radio" name="category" value="" id="cat_all" {% if not selected_category %}checked{% endif %} onchange="this.form.submit()">
                <label class="form-check-label small" for="cat_all">All Categories</label>
              </div>
              {% for cat in categories %}
              <div class="form-check mb-1">
                <input class="form-check-input" type="radio" name="category" value="{{ cat.id }}" id="cat_{{ cat.id }}" {% if selected_category == cat.id|stringformat:"s" %}checked{% endif %} onchange="this.form.submit()">
                <label class="form-check-label small" for="cat_{{ cat.id }}">{{ cat.name }}</label>
              </div>
              {% endfor %}
            </div>
            <hr>
            <div class="fw-bold mb-2" style="font-size:.9rem"><i class="bi bi-rulers me-1"></i>SIZE</div>
            <div class="d-flex flex-wrap gap-2 mb-3">
              {% for sz in "XS,S,M,L,XL,XXL"|split:"," %}
              <a href="?size={{ sz }}{% if selected_category %}&category={{ selected_category }}{% endif %}" class="btn btn-sm {% if selected_size == sz %}btn-forest{% else %}btn-outline-secondary{% endif %}" style="border-radius:6px;padding:4px 10px;font-size:.8rem">{{ sz }}</a>
              {% endfor %}
            </div>
            <hr>
            <div class="fw-bold mb-2" style="font-size:.9rem"><i class="bi bi-currency-dollar me-1"></i>PRICE RANGE</div>
            <div class="d-flex gap-2 mb-2">
              <input type="number" name="min_price" class="form-control form-control-sm" placeholder="Min $" style="border-radius:6px">
              <input type="number" name="max_price" class="form-control form-control-sm" placeholder="Max $" style="border-radius:6px">
            </div>
            <button type="submit" class="btn btn-forest w-100 btn-sm">Apply Filters</button>
            <a href="{% url 'shop' %}" class="btn btn-outline-secondary w-100 btn-sm mt-2">Clear All</a>
          </div>
        </div>
      </form>
    </div>

    <!-- PRODUCT GRID -->
    <div class="col-lg-9">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-muted small">Showing <strong>{{ total_count }}</strong> products</span>
        <div class="d-flex align-items-center gap-2">
          <label class="text-muted small mb-0">Sort by:</label>
          <select class="form-select form-select-sm" style="width:160px;border-radius:8px" onchange="window.location='{% url 'shop' %}?sort='+this.value">
            <option value="newest" {% if sort == 'newest' %}selected{% endif %}>Newest First</option>
            <option value="price_asc" {% if sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
            <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
            <option value="rating" {% if sort == 'rating' %}selected{% endif %}>Top Rated</option>
          </select>
        </div>
      </div>
      <div class="row g-3">
        {% for p in products %}
        <div class="col-md-4 col-6">
          <div class="product-card">
            <a href="{% url 'product_detail' p.pk %}" class="text-decoration-none">
              <div class="product-img-wrap">
                {% if p.image %}<img src="{{ p.image.url }}" alt="{{ p.name }}">
                {% else %}<img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=400&q=80" alt="{{ p.name }}">{% endif %}
                <div class="badge-wrap">
                  {% if p.badge %}<span class="badge-sale">{{ p.badge }}</span>{% endif %}
                </div>
                <button class="wish-btn"><i class="bi bi-heart text-muted"></i></button>
              </div>
              <div class="product-body">
                <div class="product-label">{{ p.category.name|default:"Fashion" }}</div>
                <div class="d-flex gap-1 mb-1">
                  {% for i in "12345" %}<i class="bi bi-star-fill" style="font-size:.7rem;color:{% if forloop.counter <= p.rating|floatformat:'0' %}#f59e0b{% else %}#ddd{% endif %}"></i>{% endfor %}
                  <span style="font-size:.7rem;color:var(--muted)">({{ p.review_count }})</span>
                </div>
                <div class="product-name" style="color:var(--ink)">{{ p.name }}</div>
                <div class="d-flex justify-content-between align-items-center mt-2">
                  <div>
                    <span class="product-price">${{ p.price }}</span>
                    {% if p.original_price %}<span class="product-price-old">${{ p.original_price }}</span>{% endif %}
                  </div>
                </div>
              </div>
            </a>
            <div class="px-3 pb-3">
              <form method="post" action="{% url 'cart_add' p.pk %}">
                {% csrf_token %}
                <input type="hidden" name="size" value="M">
                <input type="hidden" name="color" value="{{ p.get_colors.0 }}">
                <button type="submit" class="btn btn-forest w-100 btn-sm" style="border-radius:8px"><i class="bi bi-cart me-1"></i>Add to Cart</button>
              </form>
            </div>
          </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5 text-muted">
          <i class="bi bi-bag-x fs-1 d-block mb-3"></i>No products found. <a href="{% url 'shop' %}">Clear filters</a>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% include 'store/footer.html' %}
{% endblock %}
