{% extends 'store/base.html' %}
{% block title %}{{ product.name }} — LuxeDress{% endblock %}
{% block body %}
{% include 'store/navbar.html' %}
<div class="container py-4">
  <nav aria-label="breadcrumb" class="mb-3"><ol class="breadcrumb mb-0" style="font-size:.82rem"><li class="breadcrumb-item"><a href="{% url 'home' %}" class="text-decoration-none text-muted">Home</a></li><li class="breadcrumb-item"><a href="{% url 'shop' %}" class="text-decoration-none text-muted">Women's Sale</a></li><li class="breadcrumb-item active">{{ product.name }}</li></ol></nav>
  <div class="row g-5">
    <!-- Images -->
    <div class="col-lg-5">
      <div style="border-radius:14px;overflow:hidden;background:#f5f5f5;margin-bottom:12px;position:relative">
        {% if product.discount_pct %}<span class="badge-sale position-absolute" style="top:14px;left:14px;z-index:1">SALE -{{ product.discount_pct }}%</span>{% endif %}
        {% if product.image %}<img src="{{ product.image.url }}" id="mainImg" style="width:100%;height:500px;object-fit:cover">
        {% else %}<img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=600&q=80" id="mainImg" style="width:100%;height:500px;object-fit:cover">{% endif %}
      </div>
      <div class="d-flex gap-2">
        {% if product.image %}<img src="{{ product.image.url }}" onclick="document.getElementById('mainImg').src=this.src" style="width:80px;height:90px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid var(--forest)">{% endif %}
        {% if product.image2 %}<img src="{{ product.image2.url }}" onclick="document.getElementById('mainImg').src=this.src" style="width:80px;height:90px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid var(--border)">{% endif %}
        {% if product.image3 %}<img src="{{ product.image3.url }}" onclick="document.getElementById('mainImg').src=this.src" style="width:80px;height:90px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid var(--border)">{% endif %}
      </div>
    </div>

    <!-- Details -->
    <div class="col-lg-7">
      <div style="font-size:.75rem;text-transform:uppercase;letter-spacing:1px;color:var(--muted);font-weight:600">PREMIUM COLLECTION</div>
      <h1 style="font-family:'Playfair Display',serif;font-size:2rem;font-weight:700;margin:8px 0 12px">{{ product.name }}</h1>
      <div class="d-flex align-items-center gap-2 mb-3">
        <div class="star-rating">
          {% for i in "12345" %}<i class="bi bi-star-fill"></i>{% endfor %}
        </div>
        <span class="text-muted" style="font-size:.85rem">({{ product.review_count }} reviews)</span>
      </div>
      <div class="mb-3">
        <span style="font-size:1.8rem;font-weight:700">${{ product.price }}</span>
        {% if product.original_price %}<span style="text-decoration:line-through;color:var(--muted);font-size:1.1rem;margin-left:10px">${{ product.original_price }}</span>{% endif %}
      </div>
      <p class="text-muted mb-4" style="font-size:.9rem;line-height:1.7">{{ product.description }}</p>

      <form method="post" action="{% url 'cart_add' product.pk %}">
        {% csrf_token %}
        <!-- Color -->
        <div class="mb-4">
          <div class="fw-semibold mb-2" style="font-size:.9rem">COLOR: <span id="selectedColor" style="font-weight:400;color:var(--muted)">{{ colors.0 }}</span></div>
          <div class="d-flex gap-2 flex-wrap">
            {% for color in colors %}
            <label class="color-opt" title="{{ color }}">
              <input type="radio" name="color" value="{{ color }}" style="display:none" {% if forloop.first %}checked{% endif %} onchange="document.getElementById('selectedColor').textContent=this.value">
              <span style="display:inline-block;padding:4px 12px;border-radius:20px;border:2px solid var(--border);font-size:.82rem;cursor:pointer;transition:all .2s">{{ color }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        <!-- Size -->
        <div class="mb-4">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="fw-semibold" style="font-size:.9rem">SELECT SIZE</div>
            <a href="#" class="text-muted" style="font-size:.8rem">Size Guide</a>
          </div>
          <div class="d-flex gap-2 flex-wrap">
            {% for sz in sizes %}
            <label>
              <input type="radio" name="size" value="{{ sz }}" style="display:none" {% if forloop.first %}checked{% endif %}>
              <span class="size-btn">{{ sz }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        <!-- Quantity -->
        <div class="mb-4">
          <div class="fw-semibold mb-2" style="font-size:.9rem">QUANTITY</div>
          <div class="d-flex align-items-center gap-3">
            <div class="d-flex align-items-center border rounded-2" style="border-color:var(--border)!important">
              <button type="button" class="btn btn-sm border-0 px-3" onclick="changeQty(-1)">−</button>
              <span id="qtyDisplay" style="font-weight:600;width:30px;text-align:center">1</span>
              <input type="hidden" name="quantity" id="qtyInput" value="1">
              <button type="button" class="btn btn-sm border-0 px-3" onclick="changeQty(1)">+</button>
            </div>
            <span class="text-muted small">{{ product.stock }} in stock</span>
          </div>
        </div>
        <div class="d-flex gap-3 mb-4">
          <button type="submit" class="btn btn-forest flex-fill py-2"><i class="bi bi-cart me-2"></i>ADD TO CART</button>
          <a href="{% url 'checkout' %}" class="btn py-2 px-4 fw-semibold" style="background:#1a1a1a;color:#fff;border-radius:8px">BUY NOW</a>
        </div>
      </form>
      <div class="row g-3">
        <div class="col-6 col-sm-3"><div class="text-center small text-muted"><i class="bi bi-truck d-block fs-5 text-success mb-1"></i>Free Shipping</div></div>
        <div class="col-6 col-sm-3"><div class="text-center small text-muted"><i class="bi bi-arrow-repeat d-block fs-5 text-success mb-1"></i>30-Day Returns</div></div>
        <div class="col-6 col-sm-3"><div class="text-center small text-muted"><i class="bi bi-shield-check d-block fs-5 text-success mb-1"></i>Secure Checkout</div></div>
        <div class="col-6 col-sm-3"><div class="text-center small text-muted"><i class="bi bi-leaf d-block fs-5 text-success mb-1"></i>Sustainable Fabric</div></div>
      </div>
    </div>
  </div>

  <!-- RELATED PRODUCTS -->
  {% if related %}
  <div class="mt-5">
    <h3 class="section-title mb-4">You May Also Like</h3>
    <div class="row g-3">
      {% for p in related %}
      <div class="col-6 col-md-3">
        <div class="product-card">
          <a href="{% url 'product_detail' p.pk %}" class="text-decoration-none">
            <div class="product-img-wrap">
              {% if p.image %}<img src="{{ p.image.url }}" alt="{{ p.name }}">
              {% else %}<img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=400&q=80" alt="{{ p.name }}">{% endif %}
            </div>
            <div class="product-body">
              <div class="product-name" style="color:var(--ink)">{{ p.name }}</div>
              <span class="product-price">${{ p.price }}</span>
            </div>
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% endif %}
</div>

<style>
.size-btn{display:inline-block;padding:8px 18px;border:2px solid var(--border);border-radius:8px;cursor:pointer;font-size:.85rem;font-weight:500;transition:all .2s}
input[type=radio]:checked + .size-btn{border-color:var(--forest);background:var(--forest);color:#fff}
input[type=radio]:checked + span.size-btn,.color-opt input:checked + span{border-color:var(--forest)!important;color:var(--forest)}
</style>
<script>
function changeQty(delta){
  const inp = document.getElementById('qtyInput');
  const disp = document.getElementById('qtyDisplay');
  let val = parseInt(inp.value) + delta;
  if(val < 1) val = 1;
  inp.value = val; disp.textContent = val;
}
</script>
{% include 'store/footer.html' %}
{% endblock %}
