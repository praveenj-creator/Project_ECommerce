{% extends 'store/base.html' %}
{% block title %}Checkout â€” LuxeDress{% endblock %}
{% block body %}
{% include 'store/navbar.html' %}
<div class="container py-5">
  <div class="mb-3 small text-muted">
    <a href="{% url 'cart' %}" class="text-decoration-none text-muted">Cart</a> &rsaquo;
    <a href="{% url 'checkout' %}" class="text-decoration-none text-muted">Shipping</a> &rsaquo;
    <strong style="color:var(--ink)">Payment</strong>
  </div>
  <div class="row g-5">
    <div class="col-lg-7">
      <form method="post">
        {% csrf_token %}
        <!-- SHIPPING -->
        <div class="d-flex align-items-center gap-3 mb-4">
          <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold text-white" style="width:34px;height:34px;background:var(--forest);flex-shrink:0">1</div>
          <h5 class="fw-bold mb-0">Shipping Address</h5>
        </div>
        <div class="mb-3">
          <label class="form-label small fw-semibold">Full Name</label>
          <input type="text" name="full_name" class="form-control" placeholder="Jane Doe" required style="border-radius:8px">
        </div>
        <div class="mb-3">
          <label class="form-label small fw-semibold">Detailed Address</label>
          <textarea name="address" class="form-control" rows="2" placeholder="House No, Apartment Name, Street Name" required style="border-radius:8px"></textarea>
        </div>
        <div class="row g-3 mb-4">
          <div class="col-6">
            <label class="form-label small fw-semibold">City</label>
            <input type="text" name="city" class="form-control" placeholder="Los Angeles" required style="border-radius:8px">
          </div>
          <div class="col-6">
            <label class="form-label small fw-semibold">Pincode</label>
            <input type="text" name="pincode" class="form-control" placeholder="90210" required style="border-radius:8px">
          </div>
        </div>

        <!-- PAYMENT -->
        <div class="d-flex align-items-center gap-3 mb-4">
          <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold text-white" style="width:34px;height:34px;background:var(--forest);flex-shrink:0">2</div>
          <h5 class="fw-bold mb-0">Payment Method</h5>
        </div>
        <div class="mb-3">
          <label class="d-block mb-2">
            <div class="p-3 border rounded-2 d-flex align-items-center justify-content-between" style="border-radius:10px!important;cursor:pointer" id="cardOpt">
              <div class="d-flex align-items-center gap-2">
                <input type="radio" name="payment_method" value="card" checked onchange="togglePayment('card')">
                <div>
                  <div class="fw-semibold small">Credit or Debit Card</div>
                  <div class="text-muted" style="font-size:.75rem">Pay securely using your Visa, Mastercard or Amex</div>
                </div>
              </div>
              <i class="bi bi-credit-card text-muted"></i>
            </div>
          </label>
          <label class="d-block mb-2">
            <div class="p-3 border rounded-2 d-flex align-items-center justify-content-between" style="cursor:pointer">
              <div class="d-flex align-items-center gap-2">
                <input type="radio" name="payment_method" value="upi" onchange="togglePayment('upi')">
                <div>
                  <div class="fw-semibold small">UPI / QR Code</div>
                  <div class="text-muted" style="font-size:.75rem">Google Pay, PhonePe, Paytm</div>
                </div>
              </div>
              <i class="bi bi-phone text-muted"></i>
            </div>
          </label>
          <label class="d-block mb-3">
            <div class="p-3 border rounded-2 d-flex align-items-center justify-content-between" style="cursor:pointer">
              <div class="d-flex align-items-center gap-2">
                <input type="radio" name="payment_method" value="cod" onchange="togglePayment('cod')">
                <div>
                  <div class="fw-semibold small">Cash on Delivery</div>
                  <div class="text-muted" style="font-size:.75rem">Pay when you receive your order</div>
                </div>
              </div>
              <i class="bi bi-cash-stack text-muted"></i>
            </div>
          </label>
        </div>
        <!-- Card details -->
        <div id="cardDetails" class="p-3 border rounded-2 mb-4" style="background:#f9f9f9;border-radius:10px!important">
          <div class="mb-3">
            <label class="form-label small fw-semibold text-muted">CARD NUMBER</label>
            <input type="text" class="form-control bg-white" placeholder="0000 0000 0000 0000" maxlength="19" style="border-radius:8px;font-family:monospace">
          </div>
          <div class="row g-3">
            <div class="col-6">
              <label class="form-label small fw-semibold text-muted">EXPIRY DATE</label>
              <input type="text" class="form-control bg-white" placeholder="MM/YY" style="border-radius:8px">
            </div>
            <div class="col-6">
              <label class="form-label small fw-semibold text-muted">CVV</label>
              <input type="password" class="form-control bg-white" placeholder="123" maxlength="4" style="border-radius:8px">
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-forest w-100 py-3 fw-bold" style="font-size:1rem">
          <i class="bi bi-lock-fill me-2"></i>PLACE ORDER
        </button>
        <p class="text-center text-muted mt-2" style="font-size:.75rem">ðŸ”’ SECURE ENCRYPTED CHECKOUT</p>
      </form>
    </div>

    <!-- ORDER SUMMARY -->
    <div class="col-lg-5">
      <div class="card border-0 shadow-sm" style="border-radius:12px;position:sticky;top:90px">
        <div class="card-body p-4">
          <h5 class="fw-bold mb-3">Order Summary</h5>
          {% for item in cart_items %}
          <div class="d-flex gap-3 align-items-center mb-3">
            <div style="width:56px;height:64px;border-radius:8px;overflow:hidden;flex-shrink:0;background:#f5f5f5">
              {% if item.product.image %}<img src="{{ item.product.image.url }}" style="width:100%;height:100%;object-fit:cover">
              {% else %}<img src="https://images.unsplash.com/photo-1595777457583-95e059d581b8?w=120&q=80" style="width:100%;height:100%;object-fit:cover">{% endif %}
            </div>
            <div class="flex-grow-1">
              <div class="fw-semibold" style="font-size:.88rem">{{ item.product.name }}</div>
              <div class="text-muted" style="font-size:.75rem">{{ item.color|upper }} / {{ item.size|upper }}</div>
            </div>
            <div class="fw-bold small">${{ item.product.price }}</div>
          </div>
          {% endfor %}
          <hr>
          <div class="d-flex justify-content-between small mb-2"><span class="text-muted">Subtotal</span><span>${{ subtotal }}</span></div>
          <div class="d-flex justify-content-between small mb-2"><span class="text-muted">Shipping</span><span class="text-success">{% if shipping == 0 %}FREE{% else %}${{ shipping }}{% endif %}</span></div>
          <div class="d-flex justify-content-between small mb-2"><span class="text-muted">Estimated Tax</span><span>${{ tax }}</span></div>
          {% if discount %}<div class="d-flex justify-content-between small mb-2"><span class="text-success">Discount</span><span class="text-success">-${{ discount }}</span></div>{% endif %}
          <hr>
          <div class="d-flex justify-content-between fw-bold">
            <span>Total</span><span style="color:var(--forest);font-size:1.2rem">${{ total }}</span>
          </div>
          <div class="mt-3">
            <input type="text" class="form-control form-control-sm mb-2" placeholder="Promo Code" style="border-radius:8px">
            <button class="btn btn-outline-secondary btn-sm w-100" style="border-radius:8px">Apply</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
function togglePayment(type){
  document.getElementById('cardDetails').style.display = type === 'card' ? 'block' : 'none';
}
</script>
{% include 'store/footer.html' %}
{% endblock %}
